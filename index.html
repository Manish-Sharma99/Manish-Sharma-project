<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <title>Event Invitations</title>
    <style>
      body {
        background-color: #f0f8ff;
        background-image: url(../image4.png);
        background-repeat: no-repeat;
        background-size: cover;
      }
      .navbar {
        background-color: #4a90e2 !important;
      }
      .btn-primary {
        background-color: #4a90e2;
        border-color: #4a90e2;
      }
      .btn-primary:hover {
        background-color: #3a78c9;
        border-color: #3a78c2;
      }
      .form-control:focus,
      .form-select:focus {
        border-color: #4a90e2;
        box-shadow: 0 0 0 0.2rem rgba(74, 144, 226, 0.25);
      }
      .flex-fields {
        display: flex;
        gap: 1rem;
      }
    </style>
  </head>
  <body>
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand navbar-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">Event Invitations</a>
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link active" href="#">Home</a>
          </li>
        </ul>
      </div>
    </nav>

    <!-- MAIN CONTENT -->
    <div class="container text-center mt-5">
      <h2>Welcome to Event Invitations</h2>
      <p>Send personalized invitations for all types of events!</p>
      <button
        class="btn btn-primary mt-3"
        data-bs-toggle="modal"
        data-bs-target="#invitationModal"
      >
        Get Started
      </button>
    </div>

    <!-- INVITATION MODAL -->
    <div
      class="modal fade"
      id="invitationModal"
      tabindex="-1"
      aria-labelledby="invitationModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="invitationModalLabel">
              Send an Invitation
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form class="was-validated" id="invitation-form">
              <div class="flex-fields">
                <div class="mb-3 flex-grow-1">
                  <label for="name" class="form-label"
                    ><i class="fas fa-user"></i> Receiver Name:</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="name"
                    name="name"
                    placeholder="Enter receiver's name"
                    required
                  />
                </div>
              </div>
              <div class="mb-3" id="email-container">
                <label class="form-label">Recipient's Email Addresses:</label>
                <div class="input-group mb-2 email-input">
                  <input
                    type="email"
                    class="form-control"
                    placeholder="Enter email"
                    required
                  />
                  <button type="button" class="btn btn-success add-email">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
              </div>
              <div class="mb-3">
                <label for="message" class="form-label">Message:</label>
                <textarea
                  class="form-control"
                  id="message"
                  name="message"
                  placeholder="Enter your message"
                  required
                ></textarea>
              </div>
              <div class="flex-fields">
                <div class="mb-3 flex-grow-1">
                  <label for="event-type" class="form-label">Event Type:</label>
                  <select
                    class="form-select"
                    id="event-type"
                    name="event_type"
                    required
                  >
                    <option value="">Select Event Type</option>
                    <option value="wedding">Wedding</option>
                    <option value="birthday">Birthday Celebration</option>
                    <option value="graduation">Graduation Party</option>
                    <option value="anniversary">Anniversary Party</option>
                    <option value="other">Other</option>
                  </select>
                  <div class="valid-feedback">Valid Event Type</div>
                  <div class="invalid-feedback">
                    Please select an event type.
                  </div>
                </div>
                <div class="mb-3 flex-grow-1">
                  <label for="event-date" class="form-label">Event Date:</label>
                  <input
                    type="date"
                    class="form-control"
                    id="event-date"
                    name="event_date"
                    required
                  />
                  <div class="valid-feedback">Valid Event Date</div>
                  <div class="invalid-feedback">
                    Please select a date for the event.
                  </div>
                </div>
              </div>
              <div class="mb-3">
                <label for="event-title" class="form-label">Event Title:</label>
                <input
                  type="text"
                  class="form-control"
                  id="event-title"
                  name="event_title"
                  placeholder="Enter event title"
                  required
                />
                <div class="valid-feedback">Valid Event Title</div>
                <div class="invalid-feedback">Please fill out this field.</div>
              </div>
              <div class="mb-3">
                <label for="event-location" class="form-label"
                  >Event Location:</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="event-location"
                  name="event_location"
                  placeholder="Enter event location"
                  required
                />
                <div class="valid-feedback">Valid Event Location</div>
                <div class="invalid-feedback">Please fill out this field.</div>
              </div>
              <div class="mb-3">
                <label for="attachment" class="form-label"
                  >Upload Invitation Image:</label
                >
                <input
                  type="file"
                  class="form-control"
                  id="attachment"
                  accept="image/*"
                  name="event_attachment"
                />
              </div>

              <button class="btn btn-primary" type="submit">
                Send Invitation
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // Initialize EmailJS with your public key
      (function () {
        emailjs.init("dTPv3CwoenOA1jykT"); // Replace with your actual public key
      })();

      document
        .getElementById("invitation-form")
        .addEventListener("submit", function (event) {
          event.preventDefault();

          const name = document.getElementById("name").value;
          const message = document.getElementById("message").value;

          // Collect all email input values
          const emailInputs = document.querySelectorAll(
            "#email-container input[type='email']"
          );

          // Prepare promises for each email
          const emailPromises = Array.from(emailInputs).map(function (input) {
            // Determine which template to use based on the event type
            const eventType = document.getElementById("event-type").value;
            let templateId = "";

            // Set the template ID based on event type
            if (eventType === "birthday") {
              templateId = "template_2noo5ss";  // Replace with actual template ID for birthday
            } else if (eventType === "wedding") {
              templateId = "template_o8up27q";  // Replace with actual template ID for wedding
            } else {
              templateId = "template_2noo5ss";  // Default template
            }

            const templateParams = {
              name: name,
              message: message,
              recipient_email: input.value.trim(),
              event_type: eventType,
              event_date: document.getElementById("event-date").value,
              event_title: document.getElementById("event-title").value,
              event_location: document.getElementById("event-location").value,
              event_attachment: document.getElementById("attachment").value,
            };

            return emailjs.send(
              "service_lv0jo4t",   // Replace with your EmailJS service ID
              templateId,           // Use dynamically selected template ID
              templateParams
            );
          });

          Promise.all(emailPromises)
            .then(function (responses) {
              alert("Invitations sent successfully!");
              document.getElementById("invitation-form").reset();
            })
            .catch(function (error) {
              alert(
                "Failed to send some invitations. Error: " +
                  JSON.stringify(error)
              );
            });
        });

      // Add or remove email fields dynamically
      document
        .getElementById("email-container")
        .addEventListener("click", function (event) {
          if (event.target.classList.contains("add-email")) {
            const emailContainer = document.getElementById("email-container");
            const newEmailInput = document.createElement("div");
            newEmailInput.classList.add("input-group", "mb-2", "email-input");
            newEmailInput.innerHTML = `
          <input type="email" class="form-control" placeholder="Enter email" required />
          <button type="button" class="btn btn-danger remove-email"><i class="fas fa-minus"></i></button>`;
            emailContainer.appendChild(newEmailInput);
          } else if (event.target.classList.contains("remove-email")) {
            event.target.closest(".email-input").remove();
          }
        });
    </script>
  </body>
</html>
